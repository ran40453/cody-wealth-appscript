<style>
  /* ---------------------------------------------------------
   Layer order — 必須在任何 @layer 使用前宣告順序
   --------------------------------------------------------- */
  @layer base, utilities, shared, pages, overrides;

  /* =====================================================
   色票（Palette）— 全域語意基準，供所有元件引用
   說明：在這裡新增/修改語意色，元件只吃 --tone-* 變數；
        如需新增色票，請依此格式加在這一區，並用中文註解說明用途。
   ===================================================== */
  :root {
    /* 正向（獲利/成功/上漲） */
    --tone-pos-fg: #0f766e;
    --tone-pos-bg: rgba(16, 185, 129, .12);
    --tone-pos-bd: rgba(16, 185, 129, .35);

    /* 負向（虧損/失敗/下跌） */
    --tone-neg-fg: #b91c1c;
    --tone-neg-bg: rgba(239, 68, 68, .12);
    --tone-neg-bd: rgba(239, 68, 68, .35);

    /* 中性（無變化/持平/灰階） */
    --tone-zero-fg: var(--muted);
    --tone-zero-bg: color-mix(in oklab, var(--tint) 10%, transparent);
    --tone-zero-bd: color-mix(in oklab, var(--tint) 25%, transparent);

    /* 警示（提醒/未完成/注意） */
    --tone-warn-fg: #b45309;
    --tone-warn-bg: rgba(251, 191, 36, .16);
    --tone-warn-bd: rgba(251, 191, 36, .38);

    /* 資訊（中性提示/一般訊息） */
    --tone-info-fg: #0b4a6f;
    --tone-info-bg: rgba(59, 130, 246, .12);
    --tone-info-bd: rgba(59, 130, 246, .35);

    /* --- Shared Color Tokens (Theme-aware) --- */
    --c-primary: var(--tint);
    --c-primary-600: color-mix(in oklab, var(--tint) 84%, #000 16%);
    --c-dark: #111827;
    --c-dark-700: #0f172a;
    --c-danger: var(--danger);
    --c-danger-600: color-mix(in oklab, var(--danger) 86%, #000 14%);
  }

  :root[data-theme="dark"] {
    --c-primary: var(--tint);
    --c-primary-600: color-mix(in oklab, var(--tint) 84%, #000 16%);
    --c-dark: #1f2937;
    --c-dark-700: #111827;
    --c-danger: var(--danger);
    --c-danger-600: color-mix(in oklab, var(--danger) 86%, #000 14%);
  }

  /* =========================================================
   #4 Cards / Forms / Tables（通用，已抽離）
   ========================================================= */
  @layer shared {

    /* @extract-start shared */
    .card {
      background: var(--card);
      border: 1px solid color-mix(in oklab, var(--tint) 10%, transparent);
      border-radius: var(--radius-lg);
      padding: var(--space-md);
      box-shadow: var(--card-shadow);
      overflow: hidden;
    }

    .grid {
      display: grid;
      gap: var(--space-md);
    }

    @media (min-width:1024px) {
      .grid-2 {
        grid-template-columns: 1fr 1fr;
      }
    }

    label {
      font-size: var(--fs-label);
      color: var(--muted);
      margin-bottom: var(--space-xs);
      display: block;
    }

    input,
    select,
    textarea {
      -webkit-text-size-adjust: 100%;
      width: 100%;
      padding: 12px;
      outline: none;
      border-radius: var(--radius-sm);
      background: var(--surface);
      color: var(--text);
      border: 1px solid color-mix(in oklab, var(--tint) 25%, transparent);
      font-size: var(--fs-body);
    }

    textarea {
      min-height: 72px;
      resize: vertical;
    }

    .btn,
    .btn-ghost {
      min-height: max(44px, calc(44px * var(--ui-scale)));
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-weight: 700;
      letter-spacing: .3px;
      border: 1px solid color-mix(in oklab, var(--tint) 35%, transparent);
      padding: 0 16px;
      transition: transform 0.2s var(--ease-bounce), background 0.3s var(--ease-standard), box-shadow 0.3s var(--ease-standard);
      -webkit-tap-highlight-color: transparent;
    }

    .btn {
      background: var(--btn-bg, var(--tint));
      color: var(--btn-fg, #fff);
    }

    .btn-ghost {
      background: transparent;
      color: var(--text);
    }

    .actions {
      display: flex;
      gap: var(--space-sm);
    }

    .hint {
      font-size: calc(var(--fs-label) - 1px);
      color: var(--muted);
      margin-top: var(--space-xs);
    }

    /* 通用表格 */
    table {
      width: 100%;
      border-collapse: collapse;
    }

    th,
    td {
      padding: calc(var(--table-pad) * var(--ui-scale));
      border-bottom: 1px solid color-mix(in oklab, var(--tint) 12%, transparent);
      font-size: calc(var(--table-font) * var(--ui-scale));
    }

    th {
      text-align: left;
      color: var(--muted);
      font-weight: 700;
    }

    .empty {
      color: var(--muted);
      text-align: center;
      padding: 16px;
    }

    /* 4.1 Shared KPI Primitives */
    :where(.kpi-item .v) {
      font-variant-numeric: tabular-nums;
      font-weight: 700;
    }

    /* 卡片 header 右上小鈕統一 */
    .card .card-hd .btn-ghost {
      height: 8px;
      padding: 0 10px;
      border-radius: var(--radius);
      font-weight: 600;
      line-height: 1;
      font-size: 10px;
    }

    /* 4.2 Shared KPI Grid */
    :where(.kpi-grid) {
      display: grid;
      gap: 8px;
    }

    /* 4.3 Shared KPI Item Base */
    .kpi-item {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 8px;
      align-items: center;
      padding: 6px 8px;
      border-radius: 10px;
      background: var(--kpi-bg, rgba(0, 0, 0, .03));
      font-weight: 200;
      font-size: 23px;
    }

    .kpi-item .k {
      opacity: .7;
    }

    .kpi-item .v {
      text-align: right;
    }

    .kpi-item.span2 {
      grid-column: 1 / span 2;
    }

    /* 4.4 Shared Data Cell Utilities */
    :where(.txt) {
      text-align: left;
    }

    :where(.num) {
      text-align: right;
      font-variant-numeric: tabular-nums;
    }

    /* 4.5 Shared Capsules（badge/chip） — Base */
    :where(.badge, .chip) {
      border-radius: 999px;
      line-height: 1;
    }

    /* 4.6 Shared Pills（pill/af-pill） — Base */
    :where(.pill, .af-pill) {
      border-radius: 999px;
      line-height: 1;
    }

    /* 4.7 Shared ROI Badge（統一基礎 + 色系） */
    :where(.roi-badge) {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-weight: 700;
      line-height: 1;
      vertical-align: baseline;
      border: 1px solid transparent;
    }

    .roi-badge.pos {
      color: var(--roi-pos-fg);
      background: var(--roi-pos-bg);
      border-color: var(--roi-pos-bd);
    }

    .roi-badge.neg {
      color: var(--roi-neg-fg);
      background: var(--roi-neg-bg);
      border-color: var(--roi-neg-bd);
    }

    .roi-badge.zero {
      color: var(--roi-zero-fg);
      background: var(--roi-zero-bg);
      border-color: var(--roi-zero-bd);
    }

    /* 4.8 Shared Numeric Helpers */
    :where(.ctbc-kpiBar .v, .kpi-card .v) {
      font-variant-numeric: tabular-nums;
    }

    /* 4.9 Shared Rows Grid */
    :where(.rows .r) {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 8px;
      align-items: center;
    }

    /* 4.10 Utility: Scroll Area */
    :where(.scroll-area) {
      min-height: 0;
      overflow: auto;
    }

    /* 4.11 Shared Key-Value Grids */
    :where(.kv-grid, .ctbc-grid .kv) {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 8px;
      align-items: center;
    }

    :where(.kv-duo, .ctbc-grid) {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    /* Base button — 不強制白底/白字，改用變數 */

    /* 大尺寸（不動你 page_input 的高度控制，這裡只有基礎邊角/內距） */
    :where(.btn).btn--lg {
      padding: 10px 16px;
      font-weight: 600;
      border-radius: 10px;
    }

    /* 變體：只設定變數，不直接寫顏色 → 主題自然切換 */
    :where(.btn).btn--primary {
      --btn-bg: var(--c-primary);
      --btn-bd: var(--c-primary);
      --btn-fg: #fff;
    }

    :where(.btn).btn--primary:hover {
      --btn-bg: var(--c-primary-600);
      --btn-bd: var(--c-primary-600);
    }

    :where(.btn).btn--dark {
      --btn-bg: var(--c-dark);
      --btn-bd: var(--c-dark);
      --btn-fg: #fff;
    }

    :where(.btn).btn--dark:hover {
      --btn-bg: var(--c-dark-700);
      --btn-bd: var(--c-dark-700);
    }

    :where(.btn).btn--danger {
      --btn-bg: var(--c-danger);
      --btn-bd: var(--c-danger);
      --btn-fg: #fff;
    }

    :where(.btn).btn--danger:hover {
      --btn-bg: var(--c-danger-600);
      --btn-bd: var(--c-danger-600);
    }

    /* @extract-end shared */
  }

  /* =========================================================
   #21 Page Settings
   ========================================================= */
  @layer pages {}
</style>